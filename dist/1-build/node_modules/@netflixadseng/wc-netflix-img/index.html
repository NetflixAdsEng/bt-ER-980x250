<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	

	

	<script type="text/javascript">
		
// GENERIC SOURCE TRACKER: wc-netflix-img
if (typeof module === 'undefined') { module = {}; }
module.exports = {
  "id": "1bf7de1b-e68a-454b-978e-1fda0c6352a9",
  "name": "wc-netflix-img",
  "description": "A lightweight component for images that allows dynamic binding for the source",
  "type": "web_components",
  "context": "Default",
  "state": "published",
  "updated": 1531345020012,
  "full_name": "NetflixAdsEng/wc-netflix-img",
  "html_url": "https://github.com/NetflixAdsEng/wc-netflix-img",
  "username": "GitHub",
  "version": "4.0.0"
};!(function() {
  var COMPONENT_NAME = 'netflix-img';

  if (document.registerElement) {
    var component = Object.create(HTMLElement.prototype, {
      createdCallback: {
        value: function() {
          var img = document.createElement('img');
          this.appendChild(img);
          this._attached = false;
          this._hasInited = false;
        }
      },
      detachedCallback: {
        value: function() {
          this._attached = false;
        }
      },
      attachedCallback: {
        value: function() {
          this._attached = true;

          if (this._hasInited) {
            return;
          }

          this._hasInited = true;
          
          var dom = this;
          var img = this.children[0];

          var height = dom.getAttribute('height');
          var width = dom.getAttribute('width');
          if (width) {
            img.setAttribute('width', width);
            dom.style.width = width + 'px';
          }

          if (height) {
            img.setAttribute('height', height);
            dom.style.height = height + 'px';
          }

          var MonetComponent = document.querySelector('monet-integrator');
          if (MonetComponent) {
            MonetComponent.register(this);

            MonetComponent.getMonetData().then(function(data) {
              var imgPath;
              var bindSrc = dom.getAttribute('data-dynamic-key');

              var imgId = dom.getAttribute('id');

              try {
                // absolute paths eg. assets/img.png
                if (/\.(jpe?g|png|gif|svg)$/i.test(bindSrc) || /\.(nflximg.net)/i.test(bindSrc)) {
                  imgPath = bindSrc;
                  img.setAttribute('src', bindSrc);
                } else {
                  imgPath = data.rootAssets['image.' + bindSrc].url;
                  img.setAttribute('src', imgPath);
                }
              } catch (e) {
                MonetComponent.getBackupMonetData().then(
                  function(backupData) {
                    if (backupData.rootAssets['image.' + bindSrc]) {
                      imgPath = backupData.rootAssets['image.' + bindSrc].url;
                      img.setAttribute('src', imgPath);
                    } else {
                      console.warn('Image source incorrectly set!');
                      dom.dispatchEvent(new CustomEvent('ready'));
                    }
                  },
                  function(error) {
                    console.error('Failed to load backup Monet data', error);
                  }
                );
              }

              if (imgId) {
                img.setAttribute('id', imgId + '-img');
              }
            });
          }

          img.onload = img.onerror = function(event) {
            dom.dispatchEvent(new CustomEvent('ready'));
          };
        }
      },

      preview: {
        value: function() {
          var imgPath = '//ae.nflximg.net/monet/img/c20/netflix_placement.svg';
          this.children[0].setAttribute('src', imgPath);
          this.setAttribute('width', 300);
          this.setAttribute('height', 300);
        }
      }
    });

    if (document.createElement(COMPONENT_NAME).constructor.__proto__ !== window.HTMLElement) {
      document.registerElement(COMPONENT_NAME, { prototype: component });
    }
  }
})();

	</script>
</head>

<body>
	<script>
		var component = document.createElement('netflix-img');
		component.preview();
		document.body.appendChild(component);
	</script>
</body>

</html>